---
title: "Portfolio Theory"
date: today
---

Introduction
--------------------------------------------

TODO: Given some menu of possible investments, what mix should we hold?
How should we hold value through time?

Mean-variance analysis is part of fundamental analysis, specifically
within modern portfolio theory (MPT). Developed by Harry Markowitz in 1952
and later expanded by William Sharpe, it focuses on analyzing fundamental
characteristics of securities, specifically their expected returns (mean)
and risk (variance), to construct optimal portfolios.

While technical analysis looks at price patterns and trading volumes to predict
future movements, mean-variance analysis examines the underlying statistical
properties of assets and their relationships to each other through correlations
and covariances. This approach aims to find portfolios that maximize expected
return for a given level of risk, or minimize risk for a given expected return,
creating what's known as the efficient frontier.

The key distinction is that mean-variance analysis relies on fundamental properties
of the assets (their return distributions and correlations) rather than chart
patterns or technical indicators. It forms part of the theoretical foundation
for quantitative fundamental analysis in portfolio management.


Modern portfolio theory
--------------------------------------------

### History and pedagogy

Keywords:

-   [Modern portfolio theory](https://en.wikipedia.org/wiki/Modern_portfolio_theory) (MPT)
-   [Harry Markowitz](https://en.wikipedia.org/wiki/Harry_Markowitz) (1927-2023)
-   [Markowitz model](https://en.wikipedia.org/wiki/Markowitz_model)
-   [Sharpe ratio](https://en.wikipedia.org/wiki/Sharpe_ratio)

Historical background:

-   Markowitz, H.M. (1952). Portfolio selection. [^Markowitz1952]
-   Roy, A.D. (1952). [Safety first and the holding of assets](https://www.jstor.org/stable/1907413). [^Roy1952]
-   Markowitz, H.M. (1959). *Portfolio Selection: Efficient Diversification of Investments*. [^Markowitz1959]
-   Merton, R.C. (1972). [An analytic derivation of the efficient portfolio frontier](https://www.jstor.org/stable/2329621). [^Merton1972]
-   Levy, H. & Markowitz, H.M. (1979). Approximating expected utility by a function of mean and variance. [^Levy1979]
-   In 1990, Harry Markowitz, Merton Miller, and William F. Sharpe were awarded
    the Nobel Prize in Economics "for their pioneering work in the theory of
    financial economics".
-   Markowitz, H.M. (1990). Nobel lecture: [Foundations of portfolio theory](https://www.nobelprize.org/uploads/2018/06/markowitz-lecture.pdf). [^Markowitz1990]
-   Markowitz, H.M. (2005). Market efficiency: A theoretical distinction and so what? [^Markowitz2005]

Lecture notes:

-   Armerin, F. (2023). Lecture notes: [More on mean-variance analysis](https://people.kth.se/~armerin/FinInsMathRwanda/Lecture10.pdf).
-   Das, S.R. (2016). [*Data Science: Theories, Models, Algorithms, and Analytics*](http://srdas.github.io/Papers/DSA_Book.pdf). [^Das2016]
    -   Also: Das, S.R. (2017). [Being mean with variance: Markowitz optimization](https://srdas.github.io/MLBook/PortfolioOptimization.html).
-   Ireland, P. (2013). Lecture notes: [Principles of Macroeconomics](http://irelandp.com/ec132.html).
-   Ireland, P. (2024). Lecture notes: [Mathematics for Economists](http://irelandp.com/econ7720.html).
-   Ireland, P. (2025). Lecture notes: [Financial Economics](http://irelandp.com/econ3379.html).
    -   In particular, [Lecture 6](http://irelandp.com/econ3379/notes/ch06slides.pdf)
-   Kasa, K. (2023). [Lecture notes by Ken Kasa (SFU)](https://www.sfu.ca/~kkasa/econ815_23.html)
    -   In particular, [Lecture 7](https://www.sfu.ca/~kkasa/Econ815_Lecture7.pdf)
-   Kwok, Y.K. (2017). Lecture notes: [Fundamentals of Mathematical Finance](https://www.math.hkust.edu.hk/~maykwok/MATH4512.htm). [^Kwok2017]
    -   In particular, [Lecture 2](https://www.math.hkust.edu.hk/~maykwok/courses/MATH4512/lecture%20notes/MATH4512_T2.pdf)
-   Sigman, K. (2005). [Notes on fund theorems](https://www.columbia.edu/~ks20/FE-Notes/4700-07-Notes-funds.pdf).
-   Tam, A.S. (2021). [Lagrangians and portfolio optimization](https://www.adrian.idv.hk/2021-06-22-kkt/).


### Markowitz portfolio problem

Return of a portfolio:

$$ r = \vec{w}^\intercal \, \vec{r} = \sum_i w_{i} \, r_{i} $$

Variance of a portfolio:

$$ \sigma^2 = \vec{w}^\intercal \, V \, \vec{w} = \sum_{ij} w_{i} \, V_{ij} \, w_{j}  $$

TODO: Show above  [^Luenberger1998p150]


::: {.callout-note title="Markowitz portfolio problem"}

Given an $n$-dimensional vector of expected returns, $\vec{\mu}$,
an $n\times{}n$-dimensional expected covariance matrix, $V$,
an $m\times{}n$-dimensional constraint matrix, $A$,
an $m$-dimensional constraint vector, $\vec{b}$,
and a target return, $r_{\ast}$,
solve for the portfolio weights, $\vec{w}_{\ast}$, an $n$-dimensional vector,
that are *efficient*, *i.e.* those
that minimize the standard deviation of the portfolio return, $\sigma$,
for a given target return.
Return $(\vec{w}_{\ast}, \sigma_{\ast})$. [^Markowitz1959p172]

Solve

$$ \vec{w}_{\ast} = \underset{w}{\mathrm{argmin}}\ \vec{w}^\intercal \, V \, \vec{w} $$

such that

$$ \vec{w} \cdot \vec{1} = 1 $$

$$ \vec{w} \cdot \vec{\mu} = r_{\ast} $$

and with further optional constraints

$$ A \, \vec{w} \geq \vec{b} $$

:::


There are a lot of topics to discuss about solving for the efficient frontier:

-   How there is an analytic solution if you allow shorts
-   Solving with Lagrange multipliers
-   Solving with numerical convex optimization

TODO: Discuss the above more.

It can be shown[^ItCanBeShown] that there is an analytic solution where:

$$ a \equiv \vec{1}^\intercal \, V^{-1} \, \vec{1}, \qquad  b \equiv \vec{1}^\intercal \, V^{-1} \, \vec{\mu}, \qquad c \equiv \vec{\mu}^\intercal \, V^{-1} \, \vec{\mu}, \qquad d \equiv a\,c - b^2 $$

There are two efficient portfolios of note: the minimum variance portfolio, $\vec{w}_\mathrm{min}$,
and the tangent portfolio, $\vec{w}_\mathrm{tan}$.

The *minimum variance portfolio* is

$$ \vec{w}_\mathrm{min} = \frac{V^{-1} \, \vec{1}}{a} = \frac{V^{-1} \, \vec{1}}{\vec{1}^\intercal \, V^{-1} \, \vec{1}} $$

It has a return

$$ r_\mathrm{min} = \vec{w}_\mathrm{min} \cdot \vec{\mu} = \frac{\vec{1}^\intercal \, V^{-1} \, \vec{\mu}}{a} = \frac{b}{a} $$

and a variance

$$ \sigma_\mathrm{min}^2 = \vec{w}_\mathrm{min}^\intercal \, V \, \vec{w}_\mathrm{min} = \left( \frac{\vec{1}^\intercal \, V^{-1}}{a} \right) V \left( \frac{V^{-1} \, \vec{1}}{a} \right) = \frac{\vec{1}^\intercal \, V^{-1} \, \vec{1}}{a^2} = \frac{1}{a} $$

The *tangent portfolio* is

$$ \vec{w}_\mathrm{tan} = \frac{V^{-1} \, \vec{\mu}}{b} = \frac{V^{-1} \, \vec{\mu}}{\vec{1}^\intercal \, V^{-1} \, \vec{\mu}} $$

It has a return

$$ r_\mathrm{tan} = \vec{w}_\mathrm{tan} \cdot \vec{\mu} = \frac{\vec{\mu}^\intercal \, V^{-1} \, \vec{\mu}}{b} = \frac{c}{b} $$

and a variance

$$ \sigma_\mathrm{tan}^2 = \vec{w}_\mathrm{tan}^\intercal \, V \, \vec{w}_\mathrm{tan} = \left( \frac{\vec{\mu}^\intercal \, V^{-1}}{b} \right) V \left( \frac{V^{-1} \, \vec{\mu}}{b} \right) = \frac{\vec{\mu}^\intercal \, V^{-1} \, \vec{\mu}}{b^2} = \frac{c}{b^2} $$

The efficient frontier can be written as a linear combination of any two efficient portfolios.
This is discussed in more detail in the section on [Fund theorems](#fund-theorems).
Written as a combination of the minimum variance and the tangent portfolios gives

$$ \vec{w}_{\ast} = \xi \, \vec{w}_\mathrm{min} + (1-\xi) \, \vec{w}_\mathrm{tan} $$

where

$$ \xi = (c - b \, r_{\ast}) \, a \, / \, d $$

The efficient frontier portfolio can be equivalently written

\begin{align}
\vec{w}_{\ast} &= \xi \, \vec{w}_\mathrm{min} + (1-\xi) \, \vec{w}_\mathrm{tan} \\
      &= \left( \frac{c - b \, r_{\ast}}{d} \right) a \, \vec{w}_\mathrm{min} + \left( \frac{a \, r_{\ast} - b}{d} \right) b \, \vec{w}_\mathrm{tan} \\
      &= \left( \frac{c - b \, r_{\ast}}{d} \right) V^{-1} \, \vec{1} + \left( \frac{a \, r_{\ast} - b}{d} \right) V^{-1} \, \vec{\mu}
\end{align}

Along the frontier, the return is

$$ r_{\ast} = \xi \, r_\mathrm{min} + (1-\xi) \, r_\mathrm{tan} $$

The variance is

$$ \sigma^2_{\ast} = \frac{a}{d} \, r_{\ast}^{2} - \frac{2 \, b}{d} \, r_{\ast} + \frac{c}{d} $$

TODO: Note calculation order of $\vec{w}_\mathrm{min}(\mu, V)$
and $\vec{w}_\mathrm{tan}(\mu, V, r_\mathrm{f})$, then calculate $r_{\ast}(\sigma_{\ast})$,
scanning from $\sigma_\mathrm{min}$ to $\sigma_\mathrm{max}$.

![The "Markowitz Bullet", the efficient frontier shown in
    @Markowitz_1959_Portfolio_Selection_Efficient_Diversification, p. 152.
    ](img/markowitz-bullet-1959.png){#fig-markowitz-bullet-1959}

In general, depending on the correlations of the assets, the efficient frontier portfolios will
short various positions, indicated by having negative weights.


### No-shorts frontier

If one adds an additional constraint to the Markowitz portfolio problem as stated,
requiring that we don't short any positions

$$ w_i \geq  0 $$

then the problem doesn't have an analytic solution.
TODO: Citation needed.

The *no-shorts frontier* can be solved numerically with quadratic programming.
In general, the no-shorts frontier will follow the unconstrained efficient frontier
when there isn't any shorting in the efficient portfolios,
and the no-shorts frontier will pull away from the efficient frontier
to somewhat lower returns when there is shorting on the efficient frontier.

An example of the efficient frontier and the no-shorts frontier is shown
in @fig-markowitz-portfolio-btc-2024-09-13\.

![The efficient frontier and no-shorts frontier for a few example assets,
    using daily data from 2014-01-02 to 2024-08-30, 10 years and 8 months.
    ](img/markowitz-portfolio-btc-2024-09-13.png){#fig-markowitz-portfolio-btc-2024-09-13}

[^Das2016]: @Das_2016_Data_Science_Theories_Models_Algorithms\.
[^Kwok2017]: @Kwok_2017_Lecture_notes_Fundamentals_of_Mathematical\.
[^Levy1979]: @Levy_1979_Approximating_expected_utility_by_a_function\.
[^Luenberger1998p150]: @Luenberger_1998_Investment_Science\, p. 150.
[^Markowitz1952]: @Markowitz_1952_Portfolio_selection\.
[^Markowitz1959]: @Markowitz_1959_Portfolio_Selection_Efficient_Diversification\.
[^Markowitz1959p172]: @Markowitz_1959_Portfolio_Selection_Efficient_Diversification\, p. 172.
[^Markowitz1990]: @Markowitz_1990_Nobel_lecture_Foundations_of_portfolio_theory\.
[^Markowitz2005]: @Markowitz_2005_Market_efficiency_A_theoretical_distinction\.
[^Merton1972]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio\.
[^ItCanBeShown]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio was the first
    to show there was an analytic solution to the Markowitz portfolio problem?
    For the analytic results descussed here, we generally follow
    @Kwok_2017_Lecture_notes_Fundamentals_of_Mathematical\.
    Note that we use variable names following Kwok, whereas to convert from Merton to Kwok:
    $a_\mathrm{M} = b_\mathrm{K}$, $b_\mathrm{M} = c_\mathrm{K}$, $c_\mathrm{M} = a_\mathrm{K}$.
[^Roy1952]: @Roy_1952_Safety_first_and_the_holding_of_assets\.

Quadratic programming and convex optimization are discussed in more detail
in the section on [Convex optimization](#convex-optimization).


### Efficient-market hypothesis

-   [Efficient-market hypothesis](https://en.wikipedia.org/wiki/Efficient-market_hypothesis)
-   [Eugene Fama](https://en.wikipedia.org/wiki/Eugene_Fama) (b. 1939)
-   Fama, E. (1970). [Efficient capital markets: A review of theory and empirical work](http://www.e-m-h.org/Fama70.pdf). [^Fama1970]

[^Fama1970]: @Fama_1970_Efficient_capital_markets_A_review_of_theory\.


### Lessons of MPT

Markowitz:

>   [I]n trying to make variance small it is not enough to invest in many
>   securities. It is necessary to avoid investing in securities with
>   high covariances among themselves. We should diversify across industries
>   because firms in different industries, especially industries with
>   different economic characteristics, have lower covariances than firms
>   within an industry. [^Markowitz1952p89]

[^Markowitz1952p89]: @Markowitz_1952_Portfolio_selection\, p. 89.

Dalio: "The Holy Grail", see @fig-dalio-holy-grail\.

![TODO: Citation needed.
    ](img/dalio-holy-grail.jpg){#fig-dalio-holy-grail}


Estimation of covariance matrices
--------------------------------------------

### Overview

This is how we estimate $V$ (and $\mu$).

-   [Estimation of covariance matrices](https://en.wikipedia.org/wiki/Estimation_of_covariance_matrices)
-   Marsaglia, G. (1964). [Conditional means and covariances of normal variables with singular covariance matrix](https://apps.dtic.mil/sti/tr/pdf/AD0299080.pdf). [^Marsaglia1964]
-   Coqueret, G. & Milhau, V. (2014). [Estimating covariance matrices for portfolio optimization](https://web.archive.org/web/20230928050136/https://www.gcoqueret.com/files/Estim_cov.pdf) [^Coqueret2014]
-   Fan, J., Liao, Y., & Liu, H. (2015). [An overview on the estimation of large covariance and precision matrices](https://arxiv.org/abs/1504.02995). [^Fan2015]
-   Ayyala, D.N. (2020). High-dimensional statistical inference: Theoretical development to data analytics. [^Ayyala2020]

![The correlation matrix of a few example assets
    using daily data from 2014-01-02 to 2024-08-30, 10 years and 8 months.
    ](img/corr-gldm-btc-2024-09-14.png){#fig-corr-gldm-btc-2024-09-14}

[^Ayyala2020]: @Ayyala_2020_High_dimensional_statistical_inference\.
[^Coqueret2014]: @Coqueret_2014_Estimating_covariance_matrices_for_portfolio\.
[^Fan2015]: @Fan_2015_An_overview_on_the_estimation_of_large_covariance\.
[^Marsaglia1964]: @Marsaglia_1964_Conditional_means_and_covariances_of_normal\.


### Sample mean and covariance

TODO:

-   Sample mean and covariance
-   Rolling mean and covariance


### Online mean and covariance

-   [Algorithms for calculating variance](https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance)
-   Neely, P.M. (1966). [Comparison of several algorithms for computation of means, standard deviations and correlation coefficients](https://dl.acm.org/doi/pdf/10.1145/365719.365958). [^Neely1966]
-   Ling, R.F. (1974). Comparison of several algorithms for computing sample means and variances. [^Ling1974]
-   Chan, T.F., Golub, G.H., & LeVeque, R.J. (1979). [Updating formulae and a pairwise algorithm for computing sample variances](http://infolab.stanford.edu/pub/cstr/reports/cs/tr/79/773/CS-TR-79-773.pdf). [^Chan1979]
-   P&eacute;bay, P. (2008). [Formulas for robust, one-pass parallel computation of covariances and arbitrary-order statistical moments](https://www.osti.gov/servlets/purl/1028931). [^Pebay2008]
-   Finch, T. (2009). [Incremental calculation of weighted mean and variance](https://citeseerx.ist.psu.edu/document?repid=rep1&type=pdf&doi=5f77d0594f66e49cc0e8c2b8177ead33b7137183). [^Finch2009]
-   Meng, X. (2015). [Simpler online updates for arbitrary-order central moments](https://arxiv.org/abs/1510.04923). [^Meng2015]
-   P&eacute;bay, P., Terriberry, T.B., Kolla, H. & Bennett, J. (2016). [Numerically stable, scalable formulas for parallel and online computation of higher-order multivariate central moments with arbitrary weights](https://link.springer.com/article/10.1007/s00180-015-0637-z). [^Pebay2016]
-   Schubert, E. & Gertz, M. (2018). Numerically stable parallel computation of (co-)variance. [^Schubert2018]
-   Cook, J.D. (?). [Accurately computing running variance](https://www.johndcook.com/blog/standard_deviation/).

Univariate central moments:

$$ \mu_{p} = \mathbb{E}\left[(x - \mu_{1})^{p}\right] $$

$$ M_{p} = \sum_{i}^{n} (x_i - \mu_{1})^{p} $$

$$ \mu_{p} = \frac{M_{p}}{n} \,, \qquad \mu = \frac{M_{1}}{n} \,, \qquad \sigma^2 = \frac{M_{2}}{n} $$

Online mean:

$$ \delta \equiv x_n - \mu_{n - 1} $$

$$ \hat{\mu}_{n} = \mu_{n-1} + \frac{\delta}{n} $$

Online variance:

$$ S_{n} = M_{2,n} $$

$$ \hat{\sigma}^2 = \frac{S_{n}}{n-1} $$

where the $n-1$ includes Bessel's correction for sample variance.

Incrementally,

$$ S_{n} = S_{n-1} + (x_n - \mu_{n - 1}) (x_n - \mu_n) $$

Note that for $n > 1$,

$$ (x_n - \mu_n) = \frac{n-1}{n} (x_n - \mu_{n - 1}) $$

Therefore,

$$ S_{n} = S_{n-1} + \frac{n-1}{n} (x_n - \mu_{n - 1}) (x_n - \mu_{n - 1}) $$

$$ S_{n} = S_{n-1} + \frac{n-1}{n} \delta^2 = S_{n-1} + \delta \left( \delta - \frac{\delta}{n} \right) $$

Online covariance:

$$ C_{n}(x, y) = C_{n-1} + (x_n - \bar{x}_{n - 1}) (y_n - \bar{y}_n) = C_{n-1} + \delta_{x} \delta_{y}^\prime $$

$$ C_{n}(x, y) = C_{n-1} + \frac{n-1}{n} (x_n - \bar{x}_{n - 1}) (y_n - \bar{y}_{n - 1}) = C_{n-1} + \frac{n-1}{n} \delta_{x} \delta_{y} $$

$$ \hat{V}_{xy} = \frac{C_{n}(x, y)}{n-1} $$

Matrix form:

$$ C_{n} = {C}_{n-1} + \left( \vec{x}_{n} - \vec{\mu}_{n-1} \right) \left( \vec{x}_{n} - \vec{\mu}_{n} \right)^\intercal = {C}_{n-1} + \vec{\delta} \: \vec{\delta^\prime}^\intercal $$

$$ C_{n} = {C}_{n-1} + \frac{n-1}{n} \left( \vec{x}_{n} - \vec{\mu}_{n-1} \right) \left( \vec{x}_{n} - \vec{\mu}_{n-1} \right)^\intercal = {C}_{n-1} + \frac{n-1}{n} S(\vec{x}_{n}, \vec{\mu}_{n-1}) $$

$$ \hat{V} = \frac{C_{n}}{n-1} $$

Note that the update term for the online covariance is a term in a scatter matrix, $S$,
using the currently observed data, $\vec{x}_{n}$, and the previous means, $\vec{\mu}_{n-1}$.
But also note that the $\vec{\delta} \: \vec{\delta^\prime}^\intercal$ form is also
convenient because it comes naturally normalized and can be readily generalized for weighting.

Weighted mean:

$$ \hat{\mu}_{n} = \mu_{n-1} + \frac{w_{n,n}}{W_n} \delta = \mu_{n-1} + \frac{w_{n,n}}{W_n} (x_n - \mu_{n - 1}) $$

where

$$ W_{n} = \sum_{i=1}^{n} w_{n,i} $$

Weighted covariance:

$$ C_{n} = \frac{W_n - w_{n,n}}{W_{n-1}} {C}_{n-1} + w_{n,n} \left( x_{n} - \bar{x}_{n-1} \right) \left( y_{n} - \bar{y}_{n} \right) $$

$$ C_{n} = \frac{W_n - w_{n,n}}{W_{n-1}} {C}_{n-1} + w_{n,n} \left( \vec{x}_{n} - \vec{\mu}_{n-1} \right) \left( \vec{x}_{n} - \vec{\mu}_{n} \right)^\intercal $$

where

$$ \hat{V} = \frac{C_{n}}{W_{n}} $$

Exponential-weighted mean:

$$ \alpha = 1 - \mathrm{exp}\left( \frac{-\Delta{}t}{\tau} \right) \simeq \frac{\Delta{}t}{\tau} $$

$$ \hat{\mu}_{n} = \mu_{n-1} + \alpha (x_{n} - \mu_{n-1}) = (1 - \alpha) \mu_{n-1} + \alpha x_{n} $$

where by summing a geometric series, one can show that for exponential weighting

$$ W_{n} = 1 $$

Exponential-weighted covariance:

$$ C_{n} = (1 - \alpha) {C}_{n-1} + \alpha \left( x_{n} - \bar{x}_{n-1} \right) \left( y_{n} - \bar{y}_{n} \right) $$

$$ C_{n} = (1 - \alpha) {C}_{n-1} + \alpha \left( \vec{x}_{n} - \vec{\mu}_{n-1} \right) \left( \vec{x}_{n} - \vec{\mu}_{n} \right)^\intercal $$

[^Chan1979]: @Chan_1979_Updating_formulae_and_a_pairwise_algorithm\.
[^Finch2009]: @Finch_2009_Incremental_calculation_of_weighted_mean\.
[^Ling1974]: @Ling_1974_Comparison_of_several_algorithms_for_computing\.
[^Meng2015]: @Meng_2015_Simpler_online_updates_for_arbitrary_order_central\.
[^Neely1966]: @Neely_1966_Comparison_of_several_algorithms_for_computation\.
[^Pebay2008]: @Pebay_2008_Formulas_for_robust_one_pass_parallel_computation\.
[^Pebay2016]: @Pebay_2016_Numerically_stable_scalable_formulas_for_parallel\.
[^Schubert2018]: @Schubert_2018_Numerically_stable_parallel_computation\.


### Compound annual growth rate

The value of an asset compounding at rate $r(t)$ per day
with frequency, $k=252$, trading days per year is

$$ a(t) = a(t_{0}) \left( 1 + r(t) \right)^{\frac{t}{k}} $$

The Compound Annual Growth Rate (CAGR) is

$$ r_\mathrm{CAGR} = \left( \frac{a(t)}{a(t_{0})} \right)^{\frac{k}{t}} - 1 $$

$$ \hat{\mu}_\mathrm{CAGR} = r_\mathrm{CAGR} $$


### Shrinkage estimators

-   [Shrinkage](https://en.wikipedia.org/wiki/Shrinkage_(statistics))
-   Ledoit, O. & Wolf, M. (2001). [Honey, I shrunk the sample covariance matrix](http://www.ledoit.net/honey.pdf). [^Ledoit2001]
-   Ledoit, O. & Wolf, M. (2003). [Improved estimation of the covariance matrix of stock returns with an application to portfolio selection](http://www.ledoit.net/ole2.pdf). [^Ledoit2003]

[^Ledoit2001]: @Ledoit_2001_Honey_I_shrunk_the_sample_covariance_matrix\.
[^Ledoit2003]: @Ledoit_2003_Improved_estimation_of_the_covariance_matrix\.


### Precision matrices

-   Precision matrices
-   Galloway, M. (2019). [Shrinking characteristics of precision matrix estimators: An illustration via regression](https://mattxgalloway.com/oral_manuscript/). [^Galloway2019]
-   Bax, K., Taufer, E., & Paterlini, S. (2022). [A generalized precision matrix for t-Student distributions in portfolio optimization](https://arxiv.org/abs/2203.13740). [^Bax2022]
-   Dutta, S. & Jain, S. (2023). [Precision versus shrinkage: A comparative analysis of covariance estimation methods for portfolio allocation](https://arxiv.org/abs/2305.11298). [^Dutta2023]

TODO:

-   Why are precision matrices sparse?

[^Bax2022]: @Bax_2022_A_generalized_precision_matrix_for_t_Student\.
[^Galloway2019]: @Galloway_2019_Shrinking_characteristics_of_precision_matrix\.
[^Dutta2023]: @Dutta_2023_Precision_versus_shrinkage_A_comparative_analysis\.


Convex optimization
--------------------------------------------

This is how we minimize $\sigma$.

-   Affine combinations and convex sets
-   [Linear programming](https://en.wikipedia.org/wiki/Linear_programming)
    -   [George Dantzig](https://en.wikipedia.org/wiki/George_Dantzig) (1914-2005)
-   [Quadratic programming](https://en.wikipedia.org/wiki/Quadratic_programming)
    -   No-shorts efficient frontier
    -   [Karush-Kuhn-Tucker (KKT) conditions](https://en.wikipedia.org/wiki/Karush%E2%80%93Kuhn%E2%80%93Tucker_conditions)
    -   Jagannathan, R. & Ma, T. (2003). Risk reduction in large portfolios: Why imposing the wrong constraints helps. [^Jagannathan2003]
    -   Tam, A.S. (2021). [Lagrangians and portfolio optimization](https://www.adrian.idv.hk/2021-06-22-kkt/).
-   Markowitz's  Critical Line Algorithm (CLA)
    -   Markowitz, H.M. (1956). The optimization of a quadratic function subject to linear constraints. [^Markowitz1956]
    -   Bailey, D.H & L{\'o}pez de Prado, M. (2013). [An open-source implementation of the critical-line algorithm for portfolio optimization](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2197616). [^Bailey2013]
    -   Markowitz, H.M., Starer, D., Fram, H., & Gerber, S. (2019). [Avoiding the downside: A practical review of the Critical Line Algorithm for mean-semivariance portfolio optimization](https://www.hudsonbaycapital.com/documents/FG/hudsonbay/research/599440_paper.pdf). [^Markowitz2019a]
-   Boyd, S. & Vandenberghe, L. (2004). [*Convex Optimization*](https://web.stanford.edu/~boyd/cvxbook/). [^Boyd2004]
    -   Course website at Stanford: [Convex Optimization I](https://web.stanford.edu/class/ee364a/)
    -   [Convex Optimization Short Course](https://web.stanford.edu/~boyd/papers/cvx_short_course.html)
    -   Boyd Lectures on youtube: [1](https://www.youtube.com/watch?v=kV1ru-Inzl4), [2](https://www.youtube.com/watch?v=2H4_7izio9Y), [3](https://www.youtube.com/watch?v=1menqhfNzzo), [4](https://www.youtube.com/watch?v=U2HRwA7XePU), [5](https://www.youtube.com/watch?v=AAjG1TQcL7c), [6](https://www.youtube.com/watch?v=d2jF3SXcFQ8), [7](https://www.youtube.com/watch?v=P_SuSVZnrT0), [8](https://www.youtube.com/watch?v=wsRznzNgTS0), [9](https://www.youtube.com/watch?v=whE03c84ahA), [10](https://www.youtube.com/watch?v=N3V2AdTImJE), [11](https://www.youtube.com/watch?v=trs0RI39uWI), [12](https://www.youtube.com/watch?v=ankx1lGi5jI)
-   Software:
    -   [CVXPY](https://www.cvxpy.org/)
    -   [PyPortfolioOpt](https://github.com/robertmartin8/PyPortfolioOpt)
    -   [scikit-portfolio](https://scikit-portfolio.github.io/scikit-portfolio/)
    -   [mdengler/cla/](https://github.com/mdengler/cla/)

TODO: Discuss optimizing the no-shorts frontier.

[^Bailey2013]: @Bailey_2013_An_open_source_implementation_of_the_critical_line\.
[^Boyd2004]: @Boyd_2004_Convex_Optimization\.
[^Jagannathan2003]: @Jagannathan_2003_Risk_reduction_in_large_portfolios_Why_imposing\.
[^Markowitz1956]: @Markowitz_1956_The_optimization_of_a_quadratic_function_subject\.
[^Markowitz2019a]: @Markowitz_2019_Avoiding_the_downside_A_practical_review\.


Fund theorems
--------------------------------------------

### Mutual fund separation theorem

-   [Mutual fund separation theorem](https://en.wikipedia.org/wiki/Mutual_fund_separation_theorem)
-   Cass, D. & Stiglitz, J.E. (1970). The structure of investor preferences and asset returns, and separability in portfolio allocation: A contribution to the pure theory of mutual funds. [^Cass1970]
-   Chamberlain, G. (1983). A characterization of the distributions that imply mean-variance utility functions. [^Chamberlain1983]
-   Owen, J. & Rabinovitch, R. (1983). On the class of elliptical distributions and their applications to the theory of portfolio choice. [^Owen1983]

Cass & Stiglitz:

>   [G]iven a market in which there are available $n$
>   different assets, nonetheless all the opportunities relevant to the investor’s
>   decision can be provided by a set of $m$ ($< n$) "mutual funds," i.e., a set of
>   $m$ linear combinations (with weights adding to one) of the available
>   assets. [^Cass1970p122]

[^Cass1970]: @Cass_1970_The_structure_of_investor_preferences_and_asset\.
[^Cass1970p122]: @Cass_1970_The_structure_of_investor_preferences_and_asset\, p. 122.
[^Chamberlain1983]: @Chamberlain_1983_A_characterization_of_the_distributions_that_imply\.
[^Owen1983]: @Owen_1983_On_the_class_of_elliptical_distributions_and_their\.


### Two-fund theorem

Continuing the discussion of the context of a portfolio of risky assets
(no risk-free asset; to be considered in the next section).

Tobin[^Tobin1958] is often credited as the first to note, and later
Merton[^Merton1972b] exposited more formally, the *Two-fund theorem*:

Merton:

>   Given $m$ assets satisfying the conditions [...], there are
>   two portfolios ("mutual funds") constructed from these $m$ assets,
>   such that all risk-averse individuals, who choose their portfolios so
>   as to maximize utility functions dependent only on the mean and variance
>   of their portfolios, will be indifferent in choosing
>   between portfolios from among the original $m$ assets or from these
>   two funds. [^Merton1972p1858]

Kasa:

>   Any portfolio on the efficient frontier can be written as a linear
>   combination of two fixed efficient portfolios.

$$ \vec{w}_{\ast} = \xi \, \vec{w}_{1} + (1-\xi) \, \vec{w}_{2} $$

TODO: reparameterize? [^TODOxi]

[^Merton1972b]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio\.
[^Merton1972p1858]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio\, p. 1858.
[^Tobin1958]: @Tobin_1958_Liquidity_preference_as_behavior_towards_risk\.
[^TODOxi]: TODO: Throughout this we have parameterized $\xi$ such as it goes from 0 to 1,
we go from holding asset 2 to 1. Let's reparameterize so that $\xi \rightarrow (1-\xi)$.


### One-fund theorem

Now we consider adding the posibility of holding a risk-free asset
with a risk-free return, $r_\mathrm{f}$.

*One-fund theorem*:

Kwok:

>   Any efficient portfolio [on the Capital Allocation Line] can be
>   expressed as a combination of the risk free asset and the
>   portfolio (or fund) represented by $M$.

Kasa:

>   Any portfolio on the efficient frontier can be written as a linear
>   combination of one fixed efficient non-risk-free portfolio and the risk-free
asset.

The portfolio weights are

$$ \vec{w}_{\ast} = \kappa \, \vec{w}_\mathrm{f} + (1-\kappa) \, \vec{w}_\mathrm{tan} $$

The portfolio return is

$$ r_{\ast} = \kappa \, r_\mathrm{f} + (1-\kappa) \, r_\mathrm{tan} $$

The portfolio standard deviation is

$$ \sigma_{\ast} = \left| 1-\kappa \right| \sigma_\mathrm{tan} $$

Since the efficient frontier is a linear combination of the risk-free, "cash",
and a single portfolio of risky assets, "stocks", then it forms a line in
return-risk-space from the risk-free asset to the tangent portfolio,
and follows the line further up if one allows borrowing at the risk-free rate
and investing in the tangent portfolio.
This line is called the *Capital Allocation Line* because it represents the
possible portfolios one can have depending on how much of their cash they
have deployed into risky assets in the market.

The functional form of the Capital Allocation Line is

$$ r_\mathrm{CAL}(\sigma) = r_\mathrm{f} + \sigma \, \sqrt{ a \, r_\mathrm{f}^{2} - 2 \, b \, r_\mathrm{f} + c} $$

TODO: Double-check the expression and example values of this slope.

Note that while the shape of the efficient frontier is unchanged by
introducing or varying the risk-free rate of return, which portfolio
along the frontier that is the tangent portfolio will depend on the
risk-free rate of return.

The *tangent portfolio with a risk-free asset* is

$$ \vec{w}_\mathrm{tan}  = \frac{V^{-1} \, (\vec{\mu} - r_\mathrm{f} \, \vec{1})}{\vec{1}^\intercal \, V^{-1} \, (\vec{\mu} - r_\mathrm{f} \, \vec{1})} $$

It has a return

$$ r_\mathrm{tan} = \vec{\mu} \cdot \vec{w}_\mathrm{tan} = \frac{c - b \, r_\mathrm{f}}{b - a \, r_\mathrm{f}} $$

and a variance

$$ \sigma_\mathrm{tan}^{2} = \frac{\left|\vec{\mu} - r_\mathrm{f} \, \vec{1}\right|^2}{ (\vec{\mu} - r_\mathrm{f} \, \vec{1})^\intercal \, V^{-1} \, (\vec{\mu} - r_\mathrm{f} \, \vec{1})}  = \frac{a \, r_\mathrm{f}^2 - 2 \, b \, r_\mathrm{f} + c}{(b - a \, r_\mathrm{f})^2} $$

The tangent portfolio is the portfolio with the maximum
[Sharpe ratio](https://en.wikipedia.org/wiki/Sharpe_ratio), $S_i$.

$$ S_i \equiv \frac{ r_i - r_\mathrm{f} }{ \sigma_i }  \label{eq:sharpe_ratio} $$

The Sharpe ratio is a measure of how much excess return an asset had over a risk-free asset,
adjusted for the risk as measured by the standard deviation of return.

TODO:

-   Citation needed for the one-fund theorem
-   Related to the efficient-market hypothesis: in equilibrium, the tangent portfolio becomes the market portfolio


Capital asset pricing model
--------------------------------------------

Keywords:

-   [Capital Asset Pricing Model (CAPM)](https://en.wikipedia.org/wiki/Capital_asset_pricing_model)
-   [William F. Sharpe](https://en.wikipedia.org/wiki/William_F._Sharpe) (b. 1934)
-   [Beta](https://en.wikipedia.org/wiki/Beta_(finance))
-   [Alpha](https://en.wikipedia.org/wiki/Alpha_(finance))
-   [Security Characteristic Line (SCL)](https://en.wikipedia.org/wiki/Security_characteristic_line)
-   [Security Market Line (SML)](https://en.wikipedia.org/wiki/Security_market_line)
-   [Jensen's alpha](https://en.wikipedia.org/wiki/Jensen%27s_alpha)
-   [Treynor ratio](https://en.wikipedia.org/wiki/Treynor_ratio)

Background:

-   Jensen, M. (1968). [The performance of mutual funds in the period 1945-1964](https://www.jstor.org/stable/2325404). [^Jensen1968]
-   Sharpe, W.F. (1963). A simplified model for portfolio analysis. [^Sharpe1963]
-   Sharpe, W.F. (1964). Capital asset prices: A theory of market equilibrium under conditions of risk. [^Sharpe1964]
-   Sharpe, W.F. (1999). *Portfolio Theory and Capital Markets*. [^Sharpe1999]
-   Sharpe, W.F. (1990). Nobel lecture: [Capital asset prices with and without negative holdings](https://www.nobelprize.org/uploads/2018/06/sharpe-lecture.pdf). [^Sharpe1990]

$$ \beta_i = \frac{ \mathrm{Cov}(r_i, r_m) }{ \mathrm{Var}(r_m) } = \mathrm{Cor}(r_i, r_m) \: \frac{\sigma_i}{\sigma_m} \label{eq:sharpe_beta} $$

Thought in $r_i$ vs $r_m$ space, accumulating points over time,
$\alpha_{i}$ and $\beta_{i}$ can be calculated via linear regression:

SCL:

$$ r_{it} - r_\mathrm{f} = \hat{\alpha}_i + \hat{\beta}_i \, (r_{mt} - r_\mathrm{f}) + \varepsilon_{it}  \label{eq:alpha_beta_regression} $$

The [Security Characteristic Line (SCL)](https://en.wikipedia.org/wiki/Security_characteristic_line)
is the line in $r_i$ vs $r_m$,
fit to a particular asset, $i$, with its slope, $\hat{\beta}_{i}$,
and its $(r_i - r_\mathrm{f})$ intercept, $\hat{\alpha}_i$.

[Jensen's alpha](https://en.wikipedia.org/wiki/Jensen%27s_alpha)
uses the same form, but at a particular time point, using a historical
fit for $\hat{\beta}_{i}$, but not $\alpha_{i}$.

$$ \alpha_{i} = (r_i - r_\mathrm{f}) - \hat{\beta}_{i} \, (r_m - r_\mathrm{f})  \label{eq:jensen_alpha} $$

TODO: Compare with this:

$$ \alpha_{i} = (r_i - r_\mathrm{f}) - \hat{\beta}_{i} \, (\mu_{m} - r_\mathrm{f}) $$

The [Security Market Line (SML)](https://en.wikipedia.org/wiki/Security_market_line),
thought in $r_i$ vs $\beta_i$ space, goes through the market portfolio at
($\beta_m$, $r_m$).

SML: 

$$ \mathbb{E}(r_i) = r_\mathrm{f} + \beta_i \left( \mathbb{E}(r_m) - r_\mathrm{f} \right) $$

![The Capital Asset Pricing Model (CAPM) applied to a few example assets
    using daily data from 2014-01-02 to 2024-08-30, 10 years and 8 months.
    ](img/capm-btc-2024-09-13.png){#fig-capm-btc-2024-09-13}

-   [Treynor ratio](https://en.wikipedia.org/wiki/Treynor_ratio)

$$ T_i \equiv \frac{ r_i - r_\mathrm{f} }{ \beta_i }  \label{eq:treynor_ratio} $$

-   Gibbons, M., Ross, S., & Shanken, J. (1989). [A test of the efficiency of a given portfolio](https://www.jstor.org/stable/1913625). [^Gibbons1989]
-   Luenberger, D.G. (1998). *Investment Science*. [^Luenberger1998]

[^Jensen1968]: @Jensen_1968_The_performance_of_mutual_funds_in_the_period\.
[^Gibbons1989]: @Gibbons_1989_A_test_of_the_efficiency_of_a_given_portfolio\.
[^Luenberger1998]: @Luenberger_1998_Investment_Science\.
[^Sharpe1963]: @Sharpe_1963_A_simplified_model_for_portfolio_analysis\.
[^Sharpe1964]: @Sharpe_1964_Capital_asset_prices_A_theory_of_market\.
[^Sharpe1990]: @Sharpe_1990_Nobel_lecture_Capital_asset_prices_with\.
[^Sharpe1999]: @Sharpe_1999_Portfolio_Theory_and_Capital_Markets\.


Black-Litterman model
--------------------------------------------

-   Black, F. & Litterman, R. (1991). Asset allocation.[^Black1991]
-   Black, F. & Litterman, R. (1992). Global portfolio optimization. [^Black1992]

[^Black1991]: @Black_1991_Asset_allocation\.
[^Black1992]: @Black_1992_Global_portfolio_optimization\.


Factor models
--------------------------------------------

### Factor analysis

-   [Factor analysis](https://en.wikipedia.org/wiki/Factor_analysis)


### Fama-French model

-   [Fama-French model three-factor model](https://en.wikipedia.org/wiki/Fama%E2%80%93French_three-factor_model)
-   Fama, E.F. & French, K.R. (1992). [The cross-section of expected stock returns](https://onlinelibrary.wiley.com/doi/10.1111/j.1540-6261.1992.tb04398.x). [^Fama1992]

[^Fama1992]: @Fama_1992_The_cross_section_of_expected_stock_returns\.


### Carhart four-factor model

-   [Carhart four-factor model](https://en.wikipedia.org/wiki/Carhart_four-factor_model)
-   TODO



Risk preferences
--------------------------------------------

-   Risk preferences
-   [Kelly criterion](https://en.wikipedia.org/wiki/Kelly_criterion)
    -   Kelly, J.L. (1956). [A new interpretation of information rate](https://www.princeton.edu/~wbialek/rome/refs/kelly_56.pdf). [^Kelly1956]
-   General consumption/investment problem
    -   [Gambler's ruin problem](https://en.wikipedia.org/wiki/Gambler%27s_ruin)
    -   [Merton's portfolio problem](https://en.wikipedia.org/wiki/Merton%27s_portfolio_problem)
    -   Merton, R.C. (1969). [Lifetime portfolio selection under uncertainty: The continuous-time case](https://www.jstor.org/stable/1926560). [^Merton1969]
    -   Karatzas, I., Lehoczky, J.P., Sethi, S.P., & Shreve, S.E (1986). [Explicit solution of a general consumption/investment problem](https://www.jstor.org/stable/3689808). [^Karatzas1986]
-   Conditional Value at Risk (CVaR) or [Expected shortfall](https://en.wikipedia.org/wiki/Expected_shortfall)
    -   Rockafellar, R.T. & Uryasev, S. (2000). [Optimization of conditional value-at-risk](https://sites.math.washington.edu/~rtr/papers/rtr179-CVaR1.pdf). [^Rockafellar2000]

[^Kelly1956]: @Kelly_1956_A_new_interpretation_of_information_rate\.
[^Karatzas1986]: @Karatzas_1986_Explicit_solution_of_a_general\.
[^Merton1969]: @Merton_1969_Lifetime_portfolio_selection_under_uncertainty\.
[^Rockafellar2000]: @Rockafellar_2000_Optimization_of_conditional_value_at_risk\.


Postmodern portfolio theory
--------------------------------------------

### Criticisms of MPT

-   [Post-modern portfolio theory](https://en.wikipedia.org/wiki/Post-modern_portfolio_theory)

Criticisms of MPT:

1.  Sensitivity of portfolio weights to the estimates of $\hat{\mu}$ and $\hat{V}$.
    -   Error propagation
    -   Even assuming Gaussian distributed returns
2.  Problem of induction
    -   Past performance is no guarantee of future results
    -   Criticisms of using historical estimators of $\hat{\mu}$ and $\hat{V}$
    -   Non-Gaussian distributed returns
    -   Heteroskedasticity
3.  Variance is not a good measure of risk
    -   Downside risk is better
4.  Criticisms of the Efficient Market Hypothesis


### Error propagation

-   Lo, A.W. (2002). [The statistics of Sharpe ratios](https://www.jstor.org/stable/4480405). [^Lo2002]
-   Bodnar, T. & Schmid, W. (2011). On the exact distribution of the estimated expected utility portfolio weights: Theory and applications. [^Bodnar2011]
-   Bodnar, T., Mazur, S., & Podg&oacute;rski, K. (2016). Singular inverse Wishart distribution and its application to portfolio theory. [^Bodnar2016]

[^Bodnar2011]: @Bodnar_2011_On_the_exact_distribution_of_the_estimated\.
[^Bodnar2016]: @Bodnar_2016_Singular_inverse_Wishart_distribution_and_its\.
[^Lo2002]: @Lo_2002_The_statistics_of_Sharpe_ratios\.


### Heteroskedasticity

-   [Heteroskedasticity-consistent standard errors](https://en.wikipedia.org/wiki/Heteroskedasticity-consistent_standard_errors)
-   [Autoregressive conditional heteroskedasticity](https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity)
-   [Newey-West estimator](https://en.wikipedia.org/wiki/Newey%E2%80%93West_estimator)


### Downside risk

-   [Downside risk](https://en.wikipedia.org/wiki/Downside_risk), semi-variance, semi-deviation, target semi-variance (TSV), target semi-deviation
-   Markowitz, H.M., Starer, D., Fram, H., & Gerber, S. (2019). [Avoiding the downside: A practical review of the Critical Line Algorithm for mean-semivariance portfolio optimization](https://www.hudsonbaycapital.com/documents/FG/hudsonbay/research/599440_paper.pdf). [^Markowitz2019b]
-   [Mean-Semivariance frontier](https://scikit-portfolio.github.io/scikit-portfolio/efficient_semivariance/) in [scikit-portfolio](https://scikit-portfolio.github.io/scikit-portfolio/)

$$ \mathrm{TSV}(r_i, r_\mathrm{tan}) = \mathbb{E}\left[ (r_i - r_\mathrm{tan})^2 \: \mathbb{1}_{\{r_i < r_\mathrm{tan}\}} \right]  \label{eq:target_semi_variance} $$

$$ \mathrm{TSD}(r_i, r_\mathrm{tan}) = \sqrt{\mathrm{TSV}(r_i, r_\mathrm{tan})}  \label{eq:target_semi_deviation} $$

-   [Sortino ratio](https://en.wikipedia.org/wiki/Sortino_ratio)

[^Markowitz2019b]: @Markowitz_2019_Avoiding_the_downside_A_practical_review\.


### Criticisms of the Efficient Market Hypothesis

-   Bessembinder, H. & Chan, K. (1998). [Market efficiency and the returns to technical analysis](https://www.jstor.org/stable/3666289). [^Bessembinder1998]
-   TODO: Room for fundamentally-motivated indicator analysis --- sits between fundamental analysis and technical analysis.

[^Bessembinder1998]: @Bessembinder_1998_Market_efficiency_and_the_returns_to_technical\.


### More

-   Rom, B.M. & Ferguson, K. (1993). Post-modern portfolio theory comes of age. [^Rom1993]
-   Sortino, F. (2010). *The Sortino Framework for Constructing Portfolios*. [^Sortino2010]
-   Elton, E.J., Gruber, M.J., Brown, S.J., & Goetzmann, W.N. (2014). *Modern Portfolio Theory and Investment Analysis*. [^Elton2014]
-   [Low-volatility anomaly](https://en.wikipedia.org/wiki/Low-volatility_anomaly)

[^Elton2014]: @Elton_2014_Modern_Portfolio_Theory_and_Investment_Analysis\.
[^Rom1993]: @Rom_1993_Post_modern_portfolio_theory_comes_of_age\.
[^Sortino2010]: @Sortino_2010_The_Sortino_Framework_for_Constructing_Portfolios\.


Hierarchical risk analysis
--------------------------------------------

-   Asset trees
    -   [Stock correlation network](https://en.wikipedia.org/wiki/Stock_correlation_network)
    -   Mantegna, R.N. (1998). [Hierarchical structure in financial markets](https://arxiv.org/abs/cond-mat/9802256). [^Mantegna1998]
    -   Onnela, J.P., Chakraborti, A., Kaski, K., Kert&eacute;sz, J., & Kanto, A. (2003). [Dynamics of market correlations: Taxonomy and portfolio analysis](http://arXiv.org/abs/cond-mat/0302546v1). [^Onnela2003]
    -   Onnela, J.P., Kaski, K., & Kert&eacute;sz, J. (2004). Clustering and information in correlation based financial networks. [^Onnela2004]
-   Hierarchical Risk Parity (HRP)
    -   L&oacute;pez de Prado, M. (2016). [Building diversified portfolios that outperform out-of-sample](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2708678). [^LopezDePrado2016]
    -   L&oacute;pez de Prado, M. (2018). *Advances in Financial Machine Learning*. [^LopezDePrado2018]
    -   Lohre, H., Rother, C., & Sch&auml;fer, K.A. (2020). Hierarchical Risk Parity: Accounting for tail dependencies in multi-asset multi-factor allocations. [^Lohre2020]
-   Raffinot, T. (2018). Hierarchical clustering-based asset allocation. (HCAA) [^Raffinot2018a]
-   Raffinot, T. (2018). The hierarchical equal risk contribution portfolio. (HERC) [^Raffinot2018b]
-   Hudson & Thames. (2024). The Modern Guide to Portfolio Optimization. [^Hudson2024]
-   Blogs:
    -   [hudsonthames.org](https://hudsonthames.org/an-introduction-to-the-hierarchical-risk-parity-algorithm/)
    -   [quantpedia.com](https://quantpedia.com/hierarchical-risk-parity/)
    -   [developer.nvidia.com](https://developer.nvidia.com/blog/hierarchical-risk-parity-on-rapids-an-ml-approach-to-portfolio-allocation/)

Correlation distance between two assets:

$$ d_{ij} = \sqrt{\frac{1}{2} \left( 1 - \rho_{ij} \right)}  \label{eq:hrp_distance} $$

Euclidean distance between two assets in $n$-assest space:

$$ \tilde{d}_{ij} = \sqrt{ \sum_{k=1}^{n} \left( d_{ki} - d_{kj} \right)^{2} } \label{eq:hrp_tilde_distance} $$

Note that $\tilde{d}_{ij}$ is a function of the entire correlation matrix over all assets,
whereas $d_{ij}$ is defined for asset pairs.

![Dendrogram after hierarchical clustering.](img/dendrogram.png){#fig-dendrogram}

[^Hudson2024]: @Hudson_2024_The_Modern_Guide_to_Portfolio_Optimization\.
[^Lohre2020]: @Lohre_2020_Hierarchical_Risk_Parity_Accounting_for_tail\.
[^LopezDePrado2016]: @Lopez_2016_Building_diversified_portfolios_that_outperform\.
[^LopezDePrado2018]: @Lopez_2018_Advances_in_Financial_Machine_Learning\.
[^Mantegna1998]: @Mantegna_1998_Hierarchical_structure_in_financial_markets\.
[^Onnela2003]: @Onnela_2003_Dynamics_of_market_correlations_Taxonomy\.
[^Onnela2004]: @Onnela_2004_Clustering_and_information_in_correlation_based\.
[^Raffinot2018a]: @Raffinot_2018_Hierarchical_clustering_based_asset_allocation\.
[^Raffinot2018b]: @Raffinot_2018_The_hierarchical_equal_risk_contribution_portfolio\.


