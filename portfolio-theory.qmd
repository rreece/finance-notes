---
date: today
---

# Portfolio theory {#sec-portfolio-theory}


Introduction
--------------------------------------------

Given some menu of possible investments, what mix should we hold?
How should we hold value through time?

Mean-variance analysis is part of fundamental analysis, specifically
within modern portfolio theory (MPT). Developed by Harry Markowitz in 1952
and later expanded by William Sharpe, it focuses on analyzing fundamental
characteristics of securities, specifically their expected returns (mean)
and risk (variance), to construct optimal portfolios.


Modern portfolio theory
--------------------------------------------

### History and pedagogy

Keywords:

-   [Modern portfolio theory](https://en.wikipedia.org/wiki/Modern_portfolio_theory) (MPT)
-   [Harry Markowitz](https://en.wikipedia.org/wiki/Harry_Markowitz) (1927-2023)
-   [Markowitz model](https://en.wikipedia.org/wiki/Markowitz_model)
-   [Sharpe ratio](https://en.wikipedia.org/wiki/Sharpe_ratio)

Historical background:

-   Markowitz, H.M. (1952). Portfolio selection. [^Markowitz1952]
-   Roy, A.D. (1952). [Safety first and the holding of assets](https://www.jstor.org/stable/1907413). [^Roy1952]
-   Markowitz, H.M. (1959). *Portfolio Selection: Efficient Diversification of Investments*. [^Markowitz1959]
-   Merton, R.C. (1972). [An analytic derivation of the efficient portfolio frontier](https://www.jstor.org/stable/2329621). [^Merton1972]
-   Levy, H. & Markowitz, H.M. (1979). Approximating expected utility by a function of mean and variance. [^Levy1979]
-   In 1990, Harry Markowitz, Merton Miller, and William F. Sharpe were awarded
    the Nobel Prize in Economics "for their pioneering work in the theory of
    financial economics".
-   Markowitz, H.M. (1990). Nobel lecture: [Foundations of portfolio theory](https://www.nobelprize.org/uploads/2018/06/markowitz-lecture.pdf). [^Markowitz1990]
-   Markowitz, H.M. (2005). Market efficiency: A theoretical distinction and so what? [^Markowitz2005]

Lecture notes:

-   Armerin, F. (2023). Lecture notes: [More on mean-variance analysis](https://people.kth.se/~armerin/FinInsMathRwanda/Lecture10.pdf).
-   Caflisch, R. (2003). Lecture notes: [Mathematics of Finance](https://www.math.ucla.edu/~caflisch/181.1.03f/).
-   Das, S.R. (2016). [*Data Science: Theories, Models, Algorithms, and Analytics*](http://srdas.github.io/Papers/DSA_Book.pdf). [^Das2016]
    -   Also: Das, S.R. (2017). [Being mean with variance: Markowitz optimization](https://srdas.github.io/MLBook/PortfolioOptimization.html).
-   Ireland, P. (2013). Lecture notes: [Principles of Macroeconomics](http://irelandp.com/ec132.html).
-   Ireland, P. (2024). Lecture notes: [Mathematics for Economists](http://irelandp.com/econ7720.html).
-   Ireland, P. (2025). Lecture notes: [Financial Economics](http://irelandp.com/econ3379.html).
    -   In particular, [Lecture 6](http://irelandp.com/econ3379/notes/ch06slides.pdf)
-   Kasa, K. (2023). [Lecture notes by Ken Kasa (SFU)](https://www.sfu.ca/~kkasa/econ815_23.html)
    -   In particular, [Lecture 7](https://www.sfu.ca/~kkasa/Econ815_Lecture7.pdf)
-   Kwok, Y.K. (2017). Lecture notes: [Fundamentals of Mathematical Finance](https://www.math.hkust.edu.hk/~maykwok/MATH4512.htm). [^Kwok2017]
    -   In particular, [Lecture 2](https://www.math.hkust.edu.hk/~maykwok/courses/MATH4512/lecture%20notes/MATH4512_T2.pdf)
-   Sigman, K. (2005). [Notes on fund theorems](https://www.columbia.edu/~ks20/FE-Notes/4700-07-Notes-funds.pdf).
-   Tam, A.S. (2021). [Lagrangians and portfolio optimization](https://www.adrian.idv.hk/2021-06-22-kkt/).


### Markowitz portfolio problem

Given an expected covariance, $V$, and expected returns, $r_i$,
we want to find the portfolio with the best return per risk.
How to estimate $V$ will be discussed in more detail in 
@sec-covariance-estimation.

Return of a portfolio:

$$ r = \vec{w}^\intercal \, \vec{r} = \sum_i w_{i} \, r_{i} $$

Variance of a portfolio:

$$ \sigma^2 = \vec{w}^\intercal \, V \, \vec{w} = \sum_{ij} w_{i} \, V_{ij} \, w_{j}  $$

TODO: Show above  [^Luenberger1998p150]


::: {.callout-note title="Markowitz portfolio problem"}

Given an $n$-dimensional vector of expected returns, $\vec{\mu}$,
an $n\times{}n$-dimensional expected covariance matrix, $V$,
an $m\times{}n$-dimensional constraint matrix, $A$,
an $m$-dimensional constraint vector, $\vec{b}$,
and a target return, $r_{\ast}$,
solve for the portfolio weights, $\vec{w}_{\ast}$, an $n$-dimensional vector,
that are *efficient*, *i.e.* those
that minimize the standard deviation of the portfolio return, $\sigma$,
for a given target return.
Return $(\vec{w}_{\ast}, \sigma_{\ast})$. [^Markowitz1959p172]

Solve

$$ \vec{w}_{\ast} = \underset{w}{\mathrm{argmin}}\ \vec{w}^\intercal \, V \, \vec{w} $$

such that

$$ \vec{w} \cdot \vec{1} = 1 $$

$$ \vec{w} \cdot \vec{\mu} = r_{\ast} $$

and with further optional constraints

$$ A \, \vec{w} \geq \vec{b} $$

:::


There are a lot of topics to discuss about solving for the efficient frontier:

-   How there is an analytic solution if you allow shorts
-   Solving with Lagrange multipliers
-   Solving with numerical convex optimization

TODO: Discuss the above more.

It can be shown[^ItCanBeShown] that there is an analytic solution where:

$$ a \equiv \vec{1}^\intercal \, V^{-1} \, \vec{1}, \qquad  b \equiv \vec{1}^\intercal \, V^{-1} \, \vec{\mu}, \qquad c \equiv \vec{\mu}^\intercal \, V^{-1} \, \vec{\mu}, \qquad d \equiv a\,c - b^2 $$

There are two efficient portfolios of note: the minimum variance portfolio, $\vec{w}_\mathrm{min}$,
and the tangent portfolio, $\vec{w}_\mathrm{tan}$.

The *minimum variance portfolio* is

$$ \vec{w}_\mathrm{min} = \frac{V^{-1} \, \vec{1}}{a} = \frac{V^{-1} \, \vec{1}}{\vec{1}^\intercal \, V^{-1} \, \vec{1}} $$

It has a return

$$ r_\mathrm{min} = \vec{w}_\mathrm{min} \cdot \vec{\mu} = \frac{\vec{1}^\intercal \, V^{-1} \, \vec{\mu}}{a} = \frac{b}{a} $$

and a variance

$$ \sigma_\mathrm{min}^2 = \vec{w}_\mathrm{min}^\intercal \, V \, \vec{w}_\mathrm{min} = \left( \frac{\vec{1}^\intercal \, V^{-1}}{a} \right) V \left( \frac{V^{-1} \, \vec{1}}{a} \right) = \frac{\vec{1}^\intercal \, V^{-1} \, \vec{1}}{a^2} = \frac{1}{a} $$

The *tangent portfolio* is

$$ \vec{w}_\mathrm{tan} = \frac{V^{-1} \, \vec{\mu}}{b} = \frac{V^{-1} \, \vec{\mu}}{\vec{1}^\intercal \, V^{-1} \, \vec{\mu}} $$

It has a return

$$ r_\mathrm{tan} = \vec{w}_\mathrm{tan} \cdot \vec{\mu} = \frac{\vec{\mu}^\intercal \, V^{-1} \, \vec{\mu}}{b} = \frac{c}{b} $$

and a variance

$$ \sigma_\mathrm{tan}^2 = \vec{w}_\mathrm{tan}^\intercal \, V \, \vec{w}_\mathrm{tan} = \left( \frac{\vec{\mu}^\intercal \, V^{-1}}{b} \right) V \left( \frac{V^{-1} \, \vec{\mu}}{b} \right) = \frac{\vec{\mu}^\intercal \, V^{-1} \, \vec{\mu}}{b^2} = \frac{c}{b^2} $$

The efficient frontier can be written as a linear combination of any two efficient portfolios.
This is discussed in more detail in the section on [Fund theorems](#fund-theorems).
Written as a combination of the minimum variance and the tangent portfolios gives

$$ \vec{w}_{\ast} = \psi \, \vec{w}_\mathrm{min} + (1-\psi) \, \vec{w}_\mathrm{tan} $$

where

$$ \psi = (c - b \, r_{\ast}) \, a \, / \, d $$

The efficient frontier portfolio can be equivalently written

\begin{align}
\vec{w}_{\ast} &= \psi \, \vec{w}_\mathrm{min} + (1-\psi) \, \vec{w}_\mathrm{tan} \\
      &= \left( \frac{c - b \, r_{\ast}}{d} \right) a \, \vec{w}_\mathrm{min} + \left( \frac{a \, r_{\ast} - b}{d} \right) b \, \vec{w}_\mathrm{tan} \\
      &= \left( \frac{c - b \, r_{\ast}}{d} \right) V^{-1} \, \vec{1} + \left( \frac{a \, r_{\ast} - b}{d} \right) V^{-1} \, \vec{\mu}
\end{align}

Along the frontier, the return is

$$ r_{\ast} = \psi \, r_\mathrm{min} + (1-\psi) \, r_\mathrm{tan} $$

The variance is

$$ \sigma^2_{\ast} = \frac{a}{d} \, r_{\ast}^{2} - \frac{2 \, b}{d} \, r_{\ast} + \frac{c}{d} $$

TODO: Note calculation order of $\vec{w}_\mathrm{min}(\mu, V)$
and $\vec{w}_\mathrm{tan}(\mu, V, r_\mathrm{f})$, then calculate $r_{\ast}(\sigma_{\ast})$,
scanning from $\sigma_\mathrm{min}$ to $\sigma_\mathrm{max}$.

![The "Markowitz Bullet", the efficient frontier shown in
    @Markowitz_1959_Portfolio_Selection_Efficient_Diversification, p. 152.
    ](img/markowitz-bullet-1959.png){#fig-markowitz-bullet-1959}

In general, depending on the correlations of the assets, the efficient frontier portfolios will
short various positions, indicated by having negative weights.


### No-shorts frontier

If one adds an additional constraint to the Markowitz portfolio problem as stated,
requiring that we don't short any positions

$$ w_i \geq  0 $$

then the problem doesn't have an analytic solution.
TODO: Citation needed.

The *no-shorts frontier* can be solved numerically with quadratic programming.
In general, the no-shorts frontier will follow the unconstrained efficient frontier
when there isn't any shorting in the efficient portfolios,
and the no-shorts frontier will pull away from the efficient frontier
to somewhat lower returns when there is shorting on the efficient frontier.

An example of the efficient frontier and the no-shorts frontier is shown
in @fig-markowitz-portfolio-btc-2024-09-13\.

![The efficient frontier and no-shorts frontier for a few example assets,
    using daily data from 2014-01-02 to 2024-08-30, 10 years and 8 months.
    ](img/markowitz-portfolio-btc-2024-09-13.png){#fig-markowitz-portfolio-btc-2024-09-13}

[^Das2016]: @Das_2016_Data_Science_Theories_Models_Algorithms\.
[^Kwok2017]: @Kwok_2017_Lecture_notes_Fundamentals_of_Mathematical\.
[^Levy1979]: @Levy_1979_Approximating_expected_utility_by_a_function\.
[^Luenberger1998p150]: @Luenberger_1998_Investment_Science\, p. 150.
[^Markowitz1952]: @Markowitz_1952_Portfolio_selection\.
[^Markowitz1959]: @Markowitz_1959_Portfolio_Selection_Efficient_Diversification\.
[^Markowitz1959p172]: @Markowitz_1959_Portfolio_Selection_Efficient_Diversification\, p. 172.
[^Markowitz1990]: @Markowitz_1990_Nobel_lecture_Foundations_of_portfolio_theory\.
[^Markowitz2005]: @Markowitz_2005_Market_efficiency_A_theoretical_distinction\.
[^Merton1972]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio\.
[^ItCanBeShown]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio was the first
    to show there was an analytic solution to the Markowitz portfolio problem?
    For the analytic results descussed here, we generally follow
    @Kwok_2017_Lecture_notes_Fundamentals_of_Mathematical\.
    Note that we use variable names following Kwok, whereas to convert from Merton to Kwok:
    $a_\mathrm{M} = b_\mathrm{K}$, $b_\mathrm{M} = c_\mathrm{K}$, $c_\mathrm{M} = a_\mathrm{K}$.
[^Roy1952]: @Roy_1952_Safety_first_and_the_holding_of_assets\.

Quadratic programming and convex optimization are discussed in more detail
in @sec-convex-optimization.


### Efficient-market hypothesis

-   [Efficient-market hypothesis](https://en.wikipedia.org/wiki/Efficient-market_hypothesis)
-   [Eugene Fama](https://en.wikipedia.org/wiki/Eugene_Fama) (b. 1939)
-   Fama, E.F. (1965). [The behavior of stock-market prices](https://www.jstor.org/stable/2350752). [^Fama1965]
-   Fama, E. (1970). [Efficient capital markets: A review of theory and empirical work](http://www.e-m-h.org/Fama70.pdf). [^Fama1970]

See also:

-   [Criticisms of the efficient market hypothesis](#criticisms-of-the-efficient-market-hypothesis)

[^Fama1965]: @Fama_1965_The_behavior_of_stock_market_prices\.
[^Fama1970]: @Fama_1970_Efficient_capital_markets_A_review_of_theory\.


### Lessons of MPT

Markowitz:

>   [I]n trying to make variance small it is not enough to invest in many
>   securities. It is necessary to avoid investing in securities with
>   high covariances among themselves. We should diversify across industries
>   because firms in different industries, especially industries with
>   different economic characteristics, have lower covariances than firms
>   within an industry. [^Markowitz1952p89]

[^Markowitz1952p89]: @Markowitz_1952_Portfolio_selection\, p. 89.

Dalio: ["The Holy Grail of investing"](https://youtube.com/shorts/1ks75G7tQ0g?si=BX4cbQ5jzstCpCT9), see @fig-dalio-holy-grail\.

![TODO: Citation needed. See: [financhill.com](https://financhill.com/blog/investing/ray-dalio-holy-grail-explained).
    ](img/dalio-holy-grail.jpg){#fig-dalio-holy-grail}

**Inverse variance portfolio**

Let us look at the minimum variance portfolio, which does not depend on estimating the returns.

$$ \vec{w}_\mathrm{min} = \frac{V^{-1} \, \vec{1}}{a} = \frac{V^{-1} \, \vec{1}}{\vec{1}^\intercal \, V^{-1} \, \vec{1}} $$

Consider the simplest and favorable case that the assets are uncorrelated, $V_{ij} = 0$, for $i \neq j$,
and then $V_{ii}^{-1}  = \frac{1}{V_{ii}} = \frac{1}{\sigma_{i}^{2}}$.

Therefore the minimum variance portfolio for uncorrelated assets is the
*inverse variance portfolio* (IVP):

$$ \left[ \vec{w}_\mathrm{IVP} \right]_{i} = \eta \, \frac{1}{\sigma_{i}^{2}} $$

where $\eta$ is a normalization constant, $\eta = \left( \sum_{i} \frac{1}{\sigma_{i}^{2}} \right)^{-1}$.


Fund theorems
--------------------------------------------

### Mutual fund separation theorem

-   [Mutual fund separation theorem](https://en.wikipedia.org/wiki/Mutual_fund_separation_theorem)
-   Cass, D. & Stiglitz, J.E. (1970). The structure of investor preferences and asset returns, and separability in portfolio allocation: A contribution to the pure theory of mutual funds. [^Cass1970]
-   Chamberlain, G. (1983). A characterization of the distributions that imply mean-variance utility functions. [^Chamberlain1983]
-   Owen, J. & Rabinovitch, R. (1983). On the class of elliptical distributions and their applications to the theory of portfolio choice. [^Owen1983]

Cass & Stiglitz:

>   [G]iven a market in which there are available $n$
>   different assets, nonetheless all the opportunities relevant to the investorâ€™s
>   decision can be provided by a set of $m$ ($< n$) "mutual funds," i.e., a set of
>   $m$ linear combinations (with weights adding to one) of the available
>   assets. [^Cass1970p122]

[^Cass1970]: @Cass_1970_The_structure_of_investor_preferences_and_asset\.
[^Cass1970p122]: @Cass_1970_The_structure_of_investor_preferences_and_asset\, p. 122.
[^Chamberlain1983]: @Chamberlain_1983_A_characterization_of_the_distributions_that_imply\.
[^Owen1983]: @Owen_1983_On_the_class_of_elliptical_distributions_and_their\.


### Two-fund theorem

Continuing the discussion of the context of a portfolio of risky assets
(no risk-free asset; to be considered in the next section).

Tobin[^Tobin1958] is often credited as the first to note, and later
Merton[^Merton1972b] exposited more formally, the *Two-fund theorem*:

Merton:

>   Given $m$ assets satisfying the conditions [...], there are
>   two portfolios ("mutual funds") constructed from these $m$ assets,
>   such that all risk-averse individuals, who choose their portfolios so
>   as to maximize utility functions dependent only on the mean and variance
>   of their portfolios, will be indifferent in choosing
>   between portfolios from among the original $m$ assets or from these
>   two funds. [^Merton1972p1858]

Kasa:

>   Any portfolio on the efficient frontier can be written as a linear
>   combination of two fixed efficient portfolios.

$$ \vec{w}_{\ast} = \psi \, \vec{w}_{1} + (1-\psi) \, \vec{w}_{2} $$

TODO: reparameterize? [^TODOpsi]

[^Merton1972b]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio\.
[^Merton1972p1858]: @Merton_1972_An_analytic_derivation_of_the_efficient_portfolio\, p. 1858.
[^Tobin1958]: @Tobin_1958_Liquidity_preference_as_behavior_towards_risk\.
[^TODOpsi]: TODO: Throughout this we have parameterized $\psi$ such as it goes from 0 to 1,
we go from holding asset 2 to 1. Let's reparameterize so that $\psi \rightarrow (1-\psi)$.


### One-fund theorem

Now we consider adding the posibility of holding a risk-free asset
with a risk-free return, $r_\mathrm{f}$.

*One-fund theorem*:

Kwok:

>   Any efficient portfolio can be expressed as a [linear] combination of
>   the risk free asset and the portfolio (or fund) represented by $M$.

Kasa:

>   Any portfolio on the efficient frontier can be written as a linear
>   combination of one fixed efficient non-risk-free portfolio and the risk-free
asset.

The portfolio weights are

$$ \vec{w}_{\ast} = \kappa \, \vec{w}_\mathrm{f} + (1-\kappa) \, \vec{w}_\mathrm{tan} $$

The portfolio return is

$$ r_{\ast} = \kappa \, r_\mathrm{f} + (1-\kappa) \, r_\mathrm{tan} $$

The portfolio standard deviation is

$$ \sigma_{\ast} = \left| 1-\kappa \right| \sigma_\mathrm{tan} $$

Since the efficient frontier is a linear combination of the risk-free, "cash",
and a single portfolio of risky assets, "stocks", then it forms a line in
return-risk-space from the risk-free asset to the tangent portfolio,
and follows the line further up if one allows borrowing at the risk-free rate
and investing in the tangent portfolio.
This line is called the *Capital Allocation Line* because it represents the
possible portfolios one can have depending on how much of their cash they
have deployed into risky assets in the market.

The functional form of the Capital Allocation Line is

$$ r_\mathrm{CAL}(\sigma) = r_\mathrm{f} + \sigma \, \sqrt{ a \, r_\mathrm{f}^{2} - 2 \, b \, r_\mathrm{f} + c} $$

TODO: Double-check the expression and example values of this slope.

Note that while the shape of the efficient frontier is unchanged by
introducing or varying the risk-free rate of return, which portfolio
along the frontier that is the tangent portfolio will depend on the
risk-free rate of return.

The *tangent portfolio with a risk-free asset* is

$$ \vec{w}_\mathrm{tan}  = \frac{V^{-1} \, (\vec{\mu} - r_\mathrm{f} \, \vec{1})}{\vec{1}^\intercal \, V^{-1} \, (\vec{\mu} - r_\mathrm{f} \, \vec{1})} $$

It has a return

$$ r_\mathrm{tan} = \vec{\mu} \cdot \vec{w}_\mathrm{tan} = \frac{c - b \, r_\mathrm{f}}{b - a \, r_\mathrm{f}} $$

and a variance

$$ \sigma_\mathrm{tan}^{2} = \frac{\left|\vec{\mu} - r_\mathrm{f} \, \vec{1}\right|^2}{ (\vec{\mu} - r_\mathrm{f} \, \vec{1})^\intercal \, V^{-1} \, (\vec{\mu} - r_\mathrm{f} \, \vec{1})}  = \frac{a \, r_\mathrm{f}^2 - 2 \, b \, r_\mathrm{f} + c}{(b - a \, r_\mathrm{f})^2} $$

The tangent portfolio is the portfolio with the maximum
[Sharpe ratio](https://en.wikipedia.org/wiki/Sharpe_ratio), $S_i$.

$$ S_i \equiv \frac{ r_i - r_\mathrm{f} }{ \sigma_i } $$

The Sharpe ratio is a measure of how much excess return an asset had over a risk-free asset,
adjusted for the risk as measured by the standard deviation of return.

TODO: 

-   Citation needed for the one-fund theorem
-   Related to the efficient-market hypothesis: in equilibrium, the tangent portfolio becomes the market portfolio


Capital asset pricing model
--------------------------------------------

Keywords:

-   [Capital Asset Pricing Model (CAPM)](https://en.wikipedia.org/wiki/Capital_asset_pricing_model)
-   [William F. Sharpe](https://en.wikipedia.org/wiki/William_F._Sharpe) (b. 1934)
-   [Beta](https://en.wikipedia.org/wiki/Beta_(finance))
-   [Alpha](https://en.wikipedia.org/wiki/Alpha_(finance))
-   [Security Characteristic Line (SCL)](https://en.wikipedia.org/wiki/Security_characteristic_line)
-   [Security Market Line (SML)](https://en.wikipedia.org/wiki/Security_market_line)
-   [Jensen's alpha](https://en.wikipedia.org/wiki/Jensen%27s_alpha)
-   [Treynor ratio](https://en.wikipedia.org/wiki/Treynor_ratio)

Background:

-   Sharpe, W.F. (1963). A simplified model for portfolio analysis. [^Sharpe1963]
-   Sharpe, W.F. (1964). Capital asset prices: A theory of market equilibrium under conditions of risk. [^Sharpe1964]
-   Lintner, J. (1965). [The valuation of risk assets and the selection of risky investments in stock portfolios and capital budgets](https://www.jstor.org/stable/1924119). [^Lintner1965]
-   Fama, E.F. (1968). [Risk, return and equilibrium: Some clarifying comments](https://www.jstor.org/stable/2325308). [^Fama1968]
-   Jensen, M. (1968). [The performance of mutual funds in the period 1945-1964](https://www.jstor.org/stable/2325404). [^Jensen1968]
-   Sharpe, W.F. (1990). Nobel lecture: [Capital asset prices with and without negative holdings](https://www.nobelprize.org/uploads/2018/06/sharpe-lecture.pdf). [^Sharpe1990]
-   Sharpe, W.F. (1999). *Portfolio Theory and Capital Markets*. [^Sharpe1999]
-   Fama, E.F. & French, K.R. (2004). [The capital ssset pricing model: Theory and evidence](https://www.jstor.org/stable/3216805). [^Fama2004]
-   Kolari, J.W. & Pynn&ouml;nen, S. (2023). *Investment Valuation and Asset Pricing*. [^Kolari2023]

The CAPM model return is

$$ r_\mathrm{CAPM} = r_\mathrm{f} + \alpha_i + \beta_i \, (r_\mathrm{m} - r_\mathrm{f}) $$

Thought in $r - r_\mathrm{f}$ vs $r_\mathrm{m} - r_\mathrm{f}$ space, accumulating points over time,
$\alpha_{i}$ and $\beta_{i}$ can be calculated via linear regression,
minimizing the Sum Squared Errors:

$$ \mathrm{SSE} = \sum_{t=1}^{T} \varepsilon_{it} = \sum_{t=1}^{T} \left( r_{it} - r_{\mathrm{CAPM}t} \right)^2 = \sum_{t=1}^{T} \left( r_{it} - r_{\mathrm{f}t} - \alpha_i - \beta_i \, (r_{\mathrm{m}t} - r_{\mathrm{f}t}) \right)^2 $$

Let

$$ r_i \equiv \mathbb{E}_{t}(r_{it}) $$

Since the CAPM model is linear, the regression has the analytic solution
of Ordinary Least Squares (OLS). It can be shown that [^ItCanBeShownOLS]

$$ \hat{\beta}_i = \frac{ \mathrm{Cov}(r_i, r_\mathrm{m}) }{ \mathrm{Var}(r_\mathrm{m}) } = \mathrm{Cor}(r_i, r_\mathrm{m}) \: \frac{\sigma_i}{\sigma_\mathrm{m}} $$

From which one can see that it is always the case that $\beta_\mathrm{m} = 1$.

[Jensen's alpha](https://en.wikipedia.org/wiki/Jensen%27s_alpha)
is a measure of how much an asset outperformed the CAPM return expected
from the $\beta$ term, the sensitivity to the market.

$$ \hat{\alpha}_{i} = r_i - r_\mathrm{f} - \hat{\beta}_{i} \, (r_\mathrm{m} - r_\mathrm{f})  $$

The [Security Characteristic Line (SCL)](https://en.wikipedia.org/wiki/Security_characteristic_line)
is the line in $r - r_\mathrm{f}$ vs $r_\mathrm{m}$,
fit to a particular asset, $i$, with its slope, $\hat{\beta}_{i}$,
and its intercept, $\hat{\alpha}_i$.

SCL:

$$ r_i - r_\mathrm{f} = \hat{\alpha}_i + \hat{\beta}_i \, (r_\mathrm{m} - r_\mathrm{f}) $$

If one instead thinks of the SCL in $r - r_\mathrm{f}$ vs $\beta$ space, then the slope of
an asset's SCL is the [Treynor ratio](https://en.wikipedia.org/wiki/Treynor_ratio):

$$ T_i \equiv \frac{ r_i - r_\mathrm{f} }{ \beta_i } $$

The [Security Market Line (SML)](https://en.wikipedia.org/wiki/Security_market_line),
thought in $r - r_\mathrm{f}$ vs $\beta$ space, goes through the market portfolio at
($\beta_\mathrm{m}$ = 1, $r_\mathrm{m}$).

SML: 

$$ r = r_\mathrm{f} + \beta \left( r_\mathrm{m} - r_\mathrm{f} \right) $$

![The Capital Asset Pricing Model (CAPM) applied to a few example assets
    using daily data from 2014-01-02 to 2024-08-30, 10 years and 8 months.
    ](img/capm-btc-2024-09-13.png){#fig-capm-btc-2024-09-13}

Assuming the simple form of the CAPM, the SML gives the predicted
return of an asset with a given $\beta$, and assuming $\alpha = 0$.
The $\alpha$ of an asset shows how much it outperformed above this line.

More:

-   Gibbons, M., Ross, S., & Shanken, J. (1989). [A test of the efficiency of a given portfolio](https://www.jstor.org/stable/1913625). [^Gibbons1989]
-   Luenberger, D.G. (1998). *Investment Science*. [^Luenberger1998]

[^Fama1968]: @Fama_1968_Risk_return_and_equilibrium_Some_clarifying\.
[^Fama2004]: @Fama_2004_The_capital_ssset_pricing_model_Theory\.
[^Gibbons1989]: @Gibbons_1989_A_test_of_the_efficiency_of_a_given_portfolio\.
[^Jensen1968]: @Jensen_1968_The_performance_of_mutual_funds_in_the_period\.
[^Kolari2023]: @Kolari_2023_Investment_Valuation_and_Asset_Pricing\.
[^Lintner1965]: @Lintner_1965_The_valuation_of_risk_assets_and_the_selection\.
[^Luenberger1998]: @Luenberger_1998_Investment_Science\.
[^Sharpe1963]: @Sharpe_1963_A_simplified_model_for_portfolio_analysis\.
[^Sharpe1964]: @Sharpe_1964_Capital_asset_prices_A_theory_of_market\.
[^Sharpe1990]: @Sharpe_1990_Nobel_lecture_Capital_asset_prices_with\.
[^Sharpe1999]: @Sharpe_1999_Portfolio_Theory_and_Capital_Markets\.
[^ItCanBeShownOLS]: TODO: Work out OLS.


Factor models
--------------------------------------------

### Fama-French model

-   [Fama-French model three-factor model](https://en.wikipedia.org/wiki/Fama%E2%80%93French_three-factor_model)
-   Fama, E.F. & MacBeth, J.D. (1973). [Risk, return, and equilibrium: Empirical tests](https://doi.org/10.1086/260061). [^Fama1973]
-   Fama, E.F. & French, K.R. (1992). [The cross-section of expected stock returns](https://onlinelibrary.wiley.com/doi/10.1111/j.1540-6261.1992.tb04398.x). [^Fama1992]
-   Fama, E.F. & French, K.R. (2015). [A five-factor asset pricing model](https://doi.org/10.1016/j.jfineco.2014.10.010). [^Fama2015]
-   Yontar, T. & Benham, F. (2016). [US small cap equity: Which benchmark is best?](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2770660). [^Yontar2016]
-   Fama, E.F. & French, K.R. (2017). [International tests of a five-factor asset pricing model](https://doi.org/10.1016/j.jfineco.2014.10.010). [^Fama2017]

Three-factor model:

$$ r_{it} - r_{ft} = \alpha_{i} + \beta^\mathrm{m}_{i} \, (r_{\mathrm{m}t} - r_{ft}) + \beta^\mathrm{s}_{i} \, \mathrm{SMB}_{t} + \beta^\mathrm{v}_{i} \, \mathrm{HML}_{t} + \varepsilon_{it} $$

Five-factor model:

$$ r_{it} - r_{ft} = \alpha_{i} + \beta^\mathrm{m}_{i} \, (r_{\mathrm{m}t} - r_{ft}) + \beta^\mathrm{s}_{i} \, \mathrm{SMB}_{t} + \beta^\mathrm{v}_{i} \, \mathrm{HML}_{t} + \beta^\mathrm{p}_{i} \, \mathrm{RMW}_{t} + \beta^\mathrm{i}_{i} \, \mathrm{CMA}_{t} + \varepsilon_{it} $$

-   $r_{m} - r_{f}$: The return spread between the capitalization weighted stock market and cash.
-   SMB: The return spread of small minus large stocks (i.e., the size effect).
-   HML: The return spread of cheap minus expensive stocks (i.e., the value effect).
-   RMW: The return spread of the most profitable firms minus the least profitable.
-   CMA: The return spread of firms that invest conservatively minus aggressively. [^Asness2014a]

[^Asness2014a]: @Asness_2014_Our_model_goes_to_six_and_saves_value_from\.
[^Fama1973]: @Fama_1973_Risk_return_and_equilibrium_Empirical_tests\.
[^Fama1992]: @Fama_1992_The_cross_section_of_expected_stock_returns\.
[^Fama2015]: @Fama_2015_A_five_factor_asset_pricing_model\.
[^Fama2017]: @Fama_2017_International_tests_of_a_five_factor_asset_pricing\.
[^Yontar2016]: @Yontar_2016_US_small_cap_equity_Which_benchmark_is_best\.


### Carhart four-factor model

-   [Carhart four-factor model](https://en.wikipedia.org/wiki/Carhart_four-factor_model)
-   Carhart, M.M. (1997). [On persistence in mutual fund performance](https://www.jstor.org/stable/2329556). [^Carhart1997]

Four-factor model:

$$ r_{it} - r_{ft} = \alpha_{i} + \beta^\mathrm{m}_{i} \, (r_{\mathrm{m}t} - r_{\mathrm{f}t}) + \beta^\mathrm{s}_{i} \, \mathrm{SMB}_{t} + \beta^\mathrm{v}_{i} \, \mathrm{HML}_{t} + \beta^\mathrm{mom}_{i} \, \mathrm{PR1YR}_{t} + \varepsilon_{it} $$

[^Carhart1997]: @Carhart_1997_On_persistence_in_mutual_fund_performance\.


### Asness six-factor model

-   Asness, C. & Frazzini, A. (2013). [The Devil in HML's Details](https://doi.org/10.3905/jpm.2013.39.4.049). [^Asness2013]
-   Asness, C.S. (2014). [Our model goes to six and saves value from redundancy along the way](https://www.aqr.com/Insights/Perspectives/Our-Model-Goes-to-Six-and-Saves-Value-From-Redundancy-Along-the-Way). [^Asness2014b]

Six-factor model:

$$ r_{it} - r_{ft} = \alpha_{i} + \beta^\mathrm{m}_{i} \, (r_{\mathrm{m}t} - r_{\mathrm{f}t}) + \beta^\mathrm{s}_{i} \, \mathrm{SMB}_{t} + \beta^\mathrm{v}_{i} \, \mathrm{HML}_{t} + \beta^\mathrm{p}_{i} \, \mathrm{RMW}_{t} + \beta^\mathrm{i}_{i} \, \mathrm{CMA}_{t} + \beta^\mathrm{mom}_{i} \, \mathrm{UMD}_{t} + \varepsilon_{it} $$

[^Asness2013]: @Asness_2013_The_Devil_in_HMLs_Details\.
[^Asness2014b]: @Asness_2014_Our_model_goes_to_six_and_saves_value_from\.


### General factor analysis

-   [Factor analysis](https://en.wikipedia.org/wiki/Factor_analysis)

$$ r_{it} - r_{ft} = \alpha_{i} + \sum_{j} \beta_{ij} \, F_{jt} + \varepsilon_{it} $$

-   Regression with historical data gives $\alpha_{i}$ and $\beta_{ij}$.
-   $\beta_{ij}$ is called the factor loading for factor $j$.
-   Estimate the factor premiums, $\lambda_j$, usually from historical return: $\lambda_j = \mathbb{E}_{t}(F_{jt}) = \bar{F}_{j}$.
-   Expected return: $\hat{r}_{i} - \bar{r}_{f} = \sum_{j} \beta_{ij} \, \lambda_{j}$, where looking forward, it is usually assumed that $\alpha_{i} = 0$.


Black-Litterman model
--------------------------------------------

-   [Black-Litterman model](https://en.wikipedia.org/wiki/Black%E2%80%93Litterman_model)
-   Black, F. & Litterman, R. (1991). Asset allocation.[^Black1991]
-   Black, F. & Litterman, R. (1992). Global portfolio optimization. [^Black1992]
-   He, G. & Litterman, R. (2002). The intuition behind Black-Litterman model portfolios. [^He2002]
-   Meucci, A. (2008). The Black-Litterman approach: Original model and extensions. [^Meucci2008]

[^Black1991]: @Black_1991_Asset_allocation\.
[^Black1992]: @Black_1992_Global_portfolio_optimization\.
[^He2002]: @He_2002_The_intuition_behind_Black_Litterman_model\.
[^Meucci2008]: @Meucci_2008_The_Black_Litterman_approach_Original_model\.


Risk preferences
--------------------------------------------

-   Risk preferences
-   [Kelly criterion](https://en.wikipedia.org/wiki/Kelly_criterion)
    -   Kelly, J.L. (1956). [A new interpretation of information rate](https://www.princeton.edu/~wbialek/rome/refs/kelly_56.pdf). [^Kelly1956]
-   General consumption/investment problem
    -   [Gambler's ruin problem](https://en.wikipedia.org/wiki/Gambler%27s_ruin)
    -   [Merton's portfolio problem](https://en.wikipedia.org/wiki/Merton%27s_portfolio_problem)
    -   Merton, R.C. (1969). [Lifetime portfolio selection under uncertainty: The continuous-time case](https://www.jstor.org/stable/1926560). [^Merton1969]
    -   Karatzas, I., Lehoczky, J.P., Sethi, S.P., & Shreve, S.E (1986). [Explicit solution of a general consumption/investment problem](https://www.jstor.org/stable/3689808). [^Karatzas1986]
-   Conditional Value at Risk (CVaR) or [Expected shortfall](https://en.wikipedia.org/wiki/Expected_shortfall)
    -   Rockafellar, R.T. & Uryasev, S. (2000). [Optimization of conditional value-at-risk](https://sites.math.washington.edu/~rtr/papers/rtr179-CVaR1.pdf). [^Rockafellar2000]

[^Kelly1956]: @Kelly_1956_A_new_interpretation_of_information_rate\.
[^Karatzas1986]: @Karatzas_1986_Explicit_solution_of_a_general\.
[^Merton1969]: @Merton_1969_Lifetime_portfolio_selection_under_uncertainty\.
[^Rockafellar2000]: @Rockafellar_2000_Optimization_of_conditional_value_at_risk\.


Postmodern portfolio theory
--------------------------------------------

### Criticisms of MPT

-   [Post-modern portfolio theory](https://en.wikipedia.org/wiki/Post-modern_portfolio_theory)

Criticisms of MPT:

1.  Sensitivity of portfolio weights to the estimates of $\hat{\mu}$ and $\hat{V}$.
    -   Error propagation
    -   Even assuming Gaussian distributed returns
2.  Variance is not a good measure of risk
    -   Downside risk is better
3.  Problem of induction
    -   Past performance is no guarantee of future results
    -   Criticisms of using historical estimators of $\hat{\mu}$ and $\hat{V}$
    -   Non-Gaussian distributed returns
    -   Heteroskedasticity
4.  Criticisms of the Efficient Market Hypothesis
    -   To what degree are markets efficient?


### Error propagation

-   Lo, A.W. (2002). [The statistics of Sharpe ratios](https://www.jstor.org/stable/4480405). [^Lo2002]
-   Bodnar, T. & Schmid, W. (2011). On the exact distribution of the estimated expected utility portfolio weights: Theory and applications. [^Bodnar2011]
-   Bodnar, T., Mazur, S., & Podg&oacute;rski, K. (2016). Singular inverse Wishart distribution and its application to portfolio theory. [^Bodnar2016]

[^Bodnar2011]: @Bodnar_2011_On_the_exact_distribution_of_the_estimated\.
[^Bodnar2016]: @Bodnar_2016_Singular_inverse_Wishart_distribution_and_its\.
[^Lo2002]: @Lo_2002_The_statistics_of_Sharpe_ratios\.


### Downside risk

-   [Downside risk](https://en.wikipedia.org/wiki/Downside_risk), semi-variance, semi-deviation, target semi-variance (TSV), target semi-deviation
-   Estrada, J. (2000). [The cost of equity in emerging markets: A downside risk approach](https://ssrn.com/abstract=170748). [^Estrada2000]
-   Estrada, J. (2002). [Systematic risk in emerging markets: The D-CAPM](https://blog.iese.edu/jestrada/files/2012/06/RiskEMs-DCAPM.pdf). [^Estrada2002]
-   Estrada, J. (2008). [Mean-semivariance optimization: A heuristic approach](https://ssrn.com/abstract=1028206). [^Estrada2008]
-   Markowitz, H.M., Starer, D., Fram, H., & Gerber, S. (2019). [Avoiding the downside: A practical review of the Critical Line Algorithm for mean-semivariance portfolio optimization](https://www.hudsonbaycapital.com/documents/FG/hudsonbay/research/599440_paper.pdf). [^Markowitz2019b]
-   [Mean-Semivariance frontier](https://scikit-portfolio.github.io/scikit-portfolio/efficient_semivariance/) in [scikit-portfolio](https://scikit-portfolio.github.io/scikit-portfolio/)

$$ \mathrm{TSV}(r_i, r_\mathrm{tan}) = \mathbb{E}\left[ (r_i - r_\mathrm{tan})^2 \: \mathbb{1}_{\{r_i < r_\mathrm{tan}\}} \right]  \label{eq:target_semi_variance} $$

$$ \mathrm{TSD}(r_i, r_\mathrm{tan}) = \sqrt{\mathrm{TSV}(r_i, r_\mathrm{tan})}  \label{eq:target_semi_deviation} $$

-   [Sortino ratio](https://en.wikipedia.org/wiki/Sortino_ratio)

[^Estrada2000]: @Estrada_2000_The_cost_of_equity_in_emerging_markets_A_downside\.
[^Estrada2002]: @Estrada_2002_Systematic_risk_in_emerging_markets_The_D_CAPM\.
[^Estrada2008]: @Estrada_2008_Mean_semivariance_optimization_A_heuristic\.
[^Markowitz2019b]: @Markowitz_2019_Avoiding_the_downside_A_practical_review\.


### Heteroskedasticity

-   [Heteroskedasticity-consistent standard errors](https://en.wikipedia.org/wiki/Heteroskedasticity-consistent_standard_errors)
-   [Autoregressive conditional heteroskedasticity](https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity)
-   [Newey-West estimator](https://en.wikipedia.org/wiki/Newey%E2%80%93West_estimator)


### Criticisms of the efficient market hypothesis

-   Bessembinder, H. & Chan, K. (1998). [Market efficiency and the returns to technical analysis](https://www.jstor.org/stable/3666289). [^Bessembinder1998]
-   Asness, C.S. (2024). [The less-efficient market hypothesis](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4942046). [^Asness2024]
-   TODO: Room for fundamentally-motivated indicator analysis --- sits between fundamental analysis and technical analysis.

See also:

-   [Efficient market hypothesis](#efficient-market-hypothesis)

[^Asness2024]: @Asness_2024_The_less_efficient_market_hypothesis\.
[^Bessembinder1998]: @Bessembinder_1998_Market_efficiency_and_the_returns_to_technical\.


### More

-   Rom, B.M. & Ferguson, K. (1993). Post-modern portfolio theory comes of age. [^Rom1993]
-   Sortino, F. (2010). *The Sortino Framework for Constructing Portfolios*. [^Sortino2010]
-   Elton, E.J., Gruber, M.J., Brown, S.J., & Goetzmann, W.N. (2014). *Modern Portfolio Theory and Investment Analysis*. [^Elton2014]
-   [Low-volatility anomaly](https://en.wikipedia.org/wiki/Low-volatility_anomaly)

[^Elton2014]: @Elton_2014_Modern_Portfolio_Theory_and_Investment_Analysis\.
[^Rom1993]: @Rom_1993_Post_modern_portfolio_theory_comes_of_age\.
[^Sortino2010]: @Sortino_2010_The_Sortino_Framework_for_Constructing_Portfolios\.


Hierarchical risk analysis
--------------------------------------------

-   Asset trees
    -   [Stock correlation network](https://en.wikipedia.org/wiki/Stock_correlation_network)
    -   Mantegna, R.N. (1998). [Hierarchical structure in financial markets](https://arxiv.org/abs/cond-mat/9802256). [^Mantegna1998]
    -   Onnela, J.P., Chakraborti, A., Kaski, K., Kert&eacute;sz, J., & Kanto, A. (2003). [Dynamics of market correlations: Taxonomy and portfolio analysis](http://arXiv.org/abs/cond-mat/0302546v1). [^Onnela2003]
    -   Onnela, J.P., Kaski, K., & Kert&eacute;sz, J. (2004). Clustering and information in correlation based financial networks. [^Onnela2004]
-   Hierarchical Risk Parity (HRP)
    -   L&oacute;pez de Prado, M. (2016). [Building diversified portfolios that outperform out-of-sample](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2708678). [^LopezDePrado2016]
    -   L&oacute;pez de Prado, M. (2018). *Advances in Financial Machine Learning*. [^LopezDePrado2018]
    -   Lohre, H., Rother, C., & Sch&auml;fer, K.A. (2020). Hierarchical Risk Parity: Accounting for tail dependencies in multi-asset multi-factor allocations. [^Lohre2020]
-   Raffinot, T. (2018). Hierarchical clustering-based asset allocation. (HCAA) [^Raffinot2018a]
-   Raffinot, T. (2018). The hierarchical equal risk contribution portfolio. (HERC) [^Raffinot2018b]
-   Hudson & Thames. (2024). The Modern Guide to Portfolio Optimization. [^Hudson2024]
-   Cotton, P. (2024). [Hierarchical minimum variance portfolios: A unifying approach using Schur complements](https://github.com/microprediction/precise/blob/main/academic/Schur_Complementary_Portfolios_Peter_Cotton.pdf). [^Cotton2024]
-   Blogs:
    -   [hudsonthames.org](https://hudsonthames.org/an-introduction-to-the-hierarchical-risk-parity-algorithm/)
    -   [quantpedia.com](https://quantpedia.com/hierarchical-risk-parity/)
    -   [developer.nvidia.com](https://developer.nvidia.com/blog/hierarchical-risk-parity-on-rapids-an-ml-approach-to-portfolio-allocation/)

Correlation distance between two assets:

$$ d_{ij} = \sqrt{\frac{1}{2} \left( 1 - \rho_{ij} \right)}  \label{eq:hrp_distance} $$

Euclidean distance between two assets in $n$-assest space:

$$ \tilde{d}_{ij} = \sqrt{ \sum_{k=1}^{n} \left( d_{ki} - d_{kj} \right)^{2} } \label{eq:hrp_tilde_distance} $$

Note that $\tilde{d}_{ij}$ is a function of the entire correlation matrix over all assets,
whereas $d_{ij}$ is defined for asset pairs.

![Dendrogram after hierarchical clustering.](img/dendrogram.png){#fig-dendrogram}

[^Cotton2024]: @Cotton_2024_Hierarchical_minimum_variance_portfolios\.
[^Hudson2024]: @Hudson_2024_The_Modern_Guide_to_Portfolio_Optimization\.
[^Lohre2020]: @Lohre_2020_Hierarchical_Risk_Parity_Accounting_for_tail\.
[^LopezDePrado2016]: @Lopez_2016_Building_diversified_portfolios_that_outperform\.
[^LopezDePrado2018]: @Lopez_2018_Advances_in_Financial_Machine_Learning\.
[^Mantegna1998]: @Mantegna_1998_Hierarchical_structure_in_financial_markets\.
[^Onnela2003]: @Onnela_2003_Dynamics_of_market_correlations_Taxonomy\.
[^Onnela2004]: @Onnela_2004_Clustering_and_information_in_correlation_based\.
[^Raffinot2018a]: @Raffinot_2018_Hierarchical_clustering_based_asset_allocation\.
[^Raffinot2018b]: @Raffinot_2018_The_hierarchical_equal_risk_contribution_portfolio\.


Forecasting
--------------------------------------------

Models:

-   Vector autoregression models (VAR)
-   Bayesian VAR
-   Autoregressive conditional heteroskedasticity (ARCH)
-   Autoregressive moving average (ARMA)
-   Generalized autoregressive conditional heteroskedasticity (GARCH)
-   Autoregressive integrated moving average (ARIMA)

More:

-   Davis, J.H., Brandl-Cheng, L., & Khang, K. (2024). [Megatrends and the U.S. economy, 1890-2040](https://ssrn.com/abstract=4702028). [^Davis2024]
-   Koop, G.M. (2013). [Forecasting with medium and large Bayesian VARs](https://ssrn.com/abstract=1514412). [^Koop2013]

[^Davis2024]: @Davis_2024_Megatrends_and_the_US_economy_1890_2040\.
[^Koop2013]: @Koop_2013_Forecasting_with_medium_and_large_Bayesian_VARs\.

